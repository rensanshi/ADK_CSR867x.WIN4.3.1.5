<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>BlueLab: i2c.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BlueLab
   &#160;<span id="projectnumber">BlueLab-7.3.1-Release</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6e8ad9d85a9810be3e56ddc3a6bf3acd.html">BlueTooth</a></li><li class="navelem"><a class="el" href="dir_032c7ce75df489fbc81f9f5cafa90617.html">ADK_CSR867x.WIN4.3.1.5</a></li><li class="navelem"><a class="el" href="dir_1bf656d35252395d27302f6b51ddd826.html">tools</a></li><li class="navelem"><a class="el" href="dir_9efb167bd97b9d385990cb22ce1a9f30.html">include</a></li><li class="navelem"><a class="el" href="dir_9b9e274d222b0ae0600ea71b70413f55.html">firmware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">i2c.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Access to the i2c bus.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a029c837fda007e0e97e0f28b8863cbd8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8h.html#a029c837fda007e0e97e0f28b8863cbd8">I2cTransfer</a> (<a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> address, const <a class="el" href="csrtypes_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> *tx, <a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> tx_len, <a class="el" href="csrtypes_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> *rx, <a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> rx_len)</td></tr>
<tr class="memdesc:a029c837fda007e0e97e0f28b8863cbd8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows transfer of data across the i2c interface.  <a href="#a029c837fda007e0e97e0f28b8863cbd8">More...</a><br/></td></tr>
<tr class="separator:a029c837fda007e0e97e0f28b8863cbd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c9011de15b0e888a20de355c50f81f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="csrtypes_8h.html#a5341710c15e14e51d946a5a5f14b27a6">bool</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="i2c_8h.html#a63c9011de15b0e888a20de355c50f81f">I2cReset</a> (void)</td></tr>
<tr class="memdesc:a63c9011de15b0e888a20de355c50f81f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the I2C bus.  <a href="#a63c9011de15b0e888a20de355c50f81f">More...</a><br/></td></tr>
<tr class="separator:a63c9011de15b0e888a20de355c50f81f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Access to the i2c bus. </p>
<p>BlueCore can support one master i2c interface. </p>
<dl class="section note"><dt>Note</dt><dd>I2C PIOs in BlueCore are configured with PSKEY_I2C_SDA_PIO &amp; PSKEY_I2C_SCL_PIO if PS storage is not I2C EEPROM. The default value of I2C PIOs are defined in device datasheet. The BlueCore acts as the sole bus master. The speed of the bus (standard mode, i.e. up to 100kHz or fast mode, i.e. up to 400kHz) is configured with PSKEY_I2C_CONFIG. </dd></dl>
<dl class="section user"><dt></dt><dd>Only 7bit slave addresses are explicitly supported. However, 10bit addresses can be used by splitting the 10bit address between the slave address (11110xx) and first data byte as defined by the I2C specification. </dd></dl>
<dl class="section user"><dt></dt><dd>Use of the I2C bus requires pull-up resistors connected to the respective PIOs. Details of how to choose such resistors can be found in the I2C-Bus Specification, and recommended values for a typical design are listed in the BlueCore databooks. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a029c837fda007e0e97e0f28b8863cbd8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> I2cTransfer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="csrtypes_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> *&#160;</td>
          <td class="paramname"><em>tx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>&#160;</td>
          <td class="paramname"><em>tx_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> *&#160;</td>
          <td class="paramname"><em>rx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="csrtypes_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a>&#160;</td>
          <td class="paramname"><em>rx_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allows transfer of data across the i2c interface. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The device address of the slave for this transfer. </td></tr>
    <tr><td class="paramname">tx</td><td>A pointer to the data we wish to transmit. One octet per word. </td></tr>
    <tr><td class="paramname">tx_len</td><td>The length of the data we wish to transmit. </td></tr>
    <tr><td class="paramname">rx</td><td>A pointer to the memory we wish to read received data into. One octet per word. </td></tr>
    <tr><td class="paramname">rx_len</td><td>The length of the data we wish to receive. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes acknowledged including the address bytes and the final data byte (which isn't strictly acknowledged).</dd></dl>
<p>Perform a composite transfer consisting of a sequence of writes followed by a sequence of reads. These will be separated by a repeated start condition (Sr) and slave address if both reads and writes are performed.</p>
<p>The general sequence of operations performed is:</p>
<ul>
<li>Start condition (S).</li>
<li>Write slave address and direction byte (address | 0).</li>
<li>Write <em>tx_len</em> data bytes from the buffer at <em>tx</em>.</li>
<li>Repeated start condition (Sr) if <em>tx_len</em> and <em>rx_len</em> are non-zero.</li>
<li>Write slave address and direction byte (address | 1) if <em>tx_len</em> and <em>rx_len</em> are non-zero.</li>
<li>Read <em>rx_len</em> data bytes into the buffer at <em>rx</em>, acknowledging all but the final byte.</li>
<li>Stop condition (P).</li>
</ul>
<p>If <em>tx_len</em> is non-zero and <em>rx_len</em> is zero then the sequence reduces to:</p>
<ul>
<li>Start condition (S).</li>
<li>Write slave address and direction byte (address | 0).</li>
<li>Write <em>tx_len</em> data bytes from the buffer at <em>tx</em>.</li>
<li>Stop condition (P).</li>
</ul>
<p>Alternatively, if <em>tx_len</em> is zero and <em>rx_len</em> is non-zero then the sequence reduces to:</p>
<ul>
<li>Start condition (S).</li>
<li>Write slave address and direction byte (address | 1).</li>
<li>Read <em>rx_len</em> data bytes, acknowledging all but the final byte.</li>
<li>Stop condition (P).</li>
</ul>
<p>Finally, if both <em>tx_len</em> and <em>rx_len</em> are zero then the following minimal sequence is used:</p>
<ul>
<li>Start condition (S).</li>
<li>Write slave address and direction byte (address | 1).</li>
<li>Stop condition (P).</li>
</ul>
<p>The transfer will be aborted if the slave address or a byte being written is not acknowledged or a timeout (inter-bit / inter-byte) occurred. If the transfer is aborted due to a timeout then bus reset will be initiated using I2C bus reset procedure (see <a class="el" href="i2c_8h.html#a63c9011de15b0e888a20de355c50f81f" title="Reset the I2C bus. ">I2cReset</a>) or else only the stop condition (P) will be driven.</p>
<p>Note also that the address is not shifted before being combined with the direction bit, i.e. the slave address should occupy bits 7 to 1 of address. This allows the R/W bit to be forced to 1 for composite write/read transfers without a repeated start condition (Sr).</p>
<p>If either <em>tx_len</em> or <em>rx_len</em> exceeds 64, failure will be returned. Sometimes performance may be impaired when the i2c operation takes more time, like for example when talking to slow i2c slaves. One possible side effect of this behavior is that audio streaming may be disrupted. </p>

</div>
</div>
<a class="anchor" id="a63c9011de15b0e888a20de355c50f81f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="csrtypes_8h.html#a5341710c15e14e51d946a5a5f14b27a6">bool</a> I2cReset </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname">)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the I2C bus. </p>
<dl class="section return"><dt>Returns</dt><dd>TRUE if operation is successful, otherwise FALSE.</dd></dl>
<p>The I2C bus reset is done in following way: The SDA line is monitored on every clock cycle until the ACK/NACK phase or the 9th clock. When SDA line becomes high, a STOP condition is sent. If the SDA line becomes high before the 9th clock then continue to monitor the SDA line for rest of the clock sequence. This is done to handle a misbehaving slave which might have ignored the earlier STOP condition on the bus and pulled the SDA line low, in which case the bus reset procedure is given up. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jun 8 2018 17:58:23 for BlueLab by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
